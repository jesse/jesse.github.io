# Plan: Realtime Guitar Waveform Visualizer

1) **Input path** — Default to built‑in microphone for MVP: request `{ audio: true }` on user gesture to trigger the browser mic‑permission prompt, then pick the device whose label contains `"MacBook Microphone"` once `enumerateDevices()` reveals labels. Also support external USB interfaces: for Focusrite Scarlett Solo 3rd Gen, look for labels like `"Scarlett Solo USB"` or `"Focusrite USB"`; when present, pass its `deviceId` into `getUserMedia({ audio: { deviceId, channelCount: 1, sampleRate: 44100, echoCancellation: false } })`. Keep a simple device picker UI to switch between built‑in mic and detected interfaces.
2) **Audio graph** — Create an `AudioContext`; pipe the `MediaStreamAudioSourceNode` into a `GainNode` for trim, then into an `AnalyserNode` configured for time‑domain (e.g., `fftSize = 2048`, `smoothingTimeConstant ≈ 0`) plus optional `AudioWorkletNode` for future DSP (noise gate / tuner).
3) **Visualization loop** — On `requestAnimationFrame`, read `Uint8Array` from `getByteTimeDomainData` and draw the oscilloscope trace on `<canvas>` (fallback to `<svg>` if needed). Add simple overlays: zero line, clipping indicator, and peak‑to‑peak RMS labels.
4) **Performance & UX** — Start the audio context on user gesture; reuse a single typed array; throttle to display FPS 30‑60; expose controls for input device selection, gain, pause/resume, and buffer size (if using `AudioWorklet`).
5) **Testing** — Validate with built‑in mic (sanity), then with guitar through interface; check latency (<20 ms target), clipping headroom, and consistent rendering across Chrome/Edge/Safari.
6) **Stretch goals** — Add frequency overlay (auto‑tuner), record/playback toggle using `MediaRecorder`, dark/light themes, and optional library visual styles (e.g., Wavesurfer.js or siriwave.js) selectable without changing the core graph.
